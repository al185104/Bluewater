<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Bluewater.App.Views.Controls.TimesheetView"
			 xmlns:vm="clr-namespace:Bluewater.App.ViewModels"
			 xmlns:models="clr-namespace:Bluewater.App.Models"
			 xmlns:helpers="clr-namespace:Bluewater.App.Helpers"
			 x:DataType="vm:TimesheetsViewModel"
			 Loaded="ContentView_Loaded"
			 Unloaded="ContentView_Unloaded"
			 x:Name="TimesheetViewRoot"
			 Background="{StaticResource CollectionBackgroundBrush}">
	<Grid RowDefinitions="Auto,*,Auto"
		  Padding="20">
		<!--header-->
		<Grid Grid.Row="0"
			  ColumnDefinitions="240,Auto,*,Auto,Auto"
			  ColumnSpacing="10">
			<Picker Grid.Column="0"
					VerticalOptions="End"
					Title="Select charging"
					ItemsSource="{Binding Chargings}"
					ItemDisplayBinding="{Binding Name}"
					SelectedItem="{Binding SelectedCharging}" />
			<HorizontalStackLayout Grid.Column="1"
								   VerticalOptions="End"
								   Spacing="20">
				<Button Text="{x:Static helpers:Icon.ChevronLeft}"
						FontFamily="Icons"
						Command="{Binding PreviousPeriodCommand}"
						Style="{StaticResource SecondaryButtonStyle}" />
				<Label Text="{Binding PeriodRangeDisplay}" />
				<Button Text="{x:Static helpers:Icon.ChevronRight}"
						FontFamily="Icons"
						Command="{Binding NextPeriodCommand}"
						Style="{StaticResource SecondaryButtonStyle}" />
			</HorizontalStackLayout>
			<Button Grid.Column="3"
					Text="Upload"
					FontSize="14"
					VerticalOptions="End"
					ImageSource="{FontImage Glyph={x:Static helpers:Icon.Upload},FontFamily=Icons, Color={StaticResource PrimaryDarkText},Size=18}"
					Style="{StaticResource SecondaryButtonStyle}" />
			<Button Grid.Column="4"
					Text="Download"
					FontSize="14"
					VerticalOptions="End"
					ImageSource="{FontImage Glyph={x:Static helpers:Icon.Download},FontFamily=Icons, Color={StaticResource PrimaryDarkText},Size=18}"
					Style="{StaticResource SecondaryButtonStyle}" />
		</Grid>
		<!--body-->
		<CollectionView Grid.Row="1"
						ItemsSource="{Binding Timesheets}"
						ItemsUpdatingScrollMode="KeepScrollOffset">
			<CollectionView.Header>
				<Grid ColumnSpacing="12"
					  ColumnDefinitions="2*,*,*,*,Auto,40">
					<Label Grid.Column="0"
						   Text="Employee"
						   FontAttributes="Bold" />
					<Label Grid.Column="1"
							Text="Work Hours"
							FontAttributes="Bold" />
					<Label Grid.Column="2"
							Text="Break Hours"
							FontAttributes="Bold" />
					<Label Grid.Column="3"
							Text="Late Hours"
							FontAttributes="Bold" />
					<Label Grid.Column="4"
							Text="Absences"
							HorizontalOptions="Center"
							FontAttributes="Bold" />
					<!--<Label Grid.Column="5"
							Text="Actions"
							HorizontalOptions="End"
							FontAttributes="Bold" />-->
				</Grid>
			</CollectionView.Header>
			<CollectionView.ItemsLayout>
				<LinearItemsLayout Orientation="Vertical"
								   ItemSpacing="5" />
			</CollectionView.ItemsLayout>
			<CollectionView.ItemTemplate>
				<DataTemplate x:DataType="models:EmployeeTimesheetSummary">
					<Border StrokeShape="RoundRectangle 5 5 5 5">
						<Grid ColumnSpacing="12"
							  Padding="10"
							  ColumnDefinitions="2*,*,*,*,Auto,Auto"
							  VerticalOptions="Center">
							<VerticalStackLayout Grid.Column="0"
												 Spacing="4">
								<Label Text="{Binding Name}"
									   FontAttributes="Bold"
									   FontSize="14"
									   LineBreakMode="TailTruncation" />
								<Label FontSize="12"
									   TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}">
									<Label.FormattedText>
										<FormattedString>
											<Span Text="{Binding Department}"
												  FontSize="12"
												  TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
											<Span Text=", "
												  FontSize="12"
												  TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
											<Span Text="{Binding Section}"
												  FontSize="12"
												  TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
										</FormattedString>
									</Label.FormattedText>
								</Label>
							</VerticalStackLayout>
							<Label Grid.Column="1"
								   Text="{Binding TotalWorkHours, StringFormat='{0:0.##}'}"
								   HorizontalTextAlignment="Start"
								   VerticalTextAlignment="Center" />
							<Label Grid.Column="2"
								   Text="{Binding TotalBreak, StringFormat='{0:0.##}'}"
								   HorizontalTextAlignment="Start"
								   VerticalTextAlignment="Center" />
							<Label Grid.Column="3"
								   Text="{Binding TotalLates, StringFormat='{0:0.##}'}"
								   HorizontalTextAlignment="Start"
								   VerticalTextAlignment="Center" />
							<Label Grid.Column="4"
								   Text="{Binding TotalAbsents}"
								   WidthRequest="30"
								   HorizontalTextAlignment="Start"
								   VerticalTextAlignment="Center" />
							<Label Grid.Column="5"
								   Grid.RowSpan="2"
								   VerticalTextAlignment="Center"
								   Text="{x:Static helpers:Icon.MoreHorizontal}"
								   FontFamily="Icons">
								<FlyoutBase.ContextFlyout>
									<MenuFlyout>
										<MenuFlyoutItem Text="Edit"
														Command="{Binding Source={x:Reference TimesheetViewRoot}, Path=BindingContext.EditTimesheetCommand}"
														CommandParameter="{Binding .}" />
										<MenuFlyoutSeparator />
									</MenuFlyout>
								</FlyoutBase.ContextFlyout>
							</Label>
							<!--<Button Grid.Column="6"
								Text="Edit"
								Command="{Binding Source={x:Reference TimesheetPageRoot}, Path=BindingContext.EditTimesheetCommand}"
								CommandParameter="{Binding .}" />-->
						</Grid>
					</Border>
				</DataTemplate>
			</CollectionView.ItemTemplate>
		</CollectionView>
		<!--<Label Grid.Row="2"
			   Text="...Ready"
			   HorizontalOptions="End">
			--><!--add triggers here based on IsLoadingMore--><!--
			<Label.Triggers>
				<DataTrigger TargetType="Label"
							 Binding="{Binding IsLoadingMore}"
							 Value="True">
					<Setter Property="Text"
							Value="...Loading more employees" />
				</DataTrigger>
			</Label.Triggers>
		</Label>-->
		<ActivityIndicator Grid.Row="1"
						   IsRunning="{Binding IsBusy}"
						   IsVisible="{Binding IsBusy}"
						   HorizontalOptions="Center"
						   VerticalOptions="Center" />
	</Grid>
</ContentView>
