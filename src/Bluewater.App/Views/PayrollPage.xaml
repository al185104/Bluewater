<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Bluewater.App.Converters"
             xmlns:models="clr-namespace:Bluewater.App.Models"
             xmlns:selectors="clr-namespace:Bluewater.App.Selectors"
             x:Class="Bluewater.App.Views.PayrollPage"
             x:Name="PayrollPageRoot"
             Title="PayrollPage">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:BooleanNegationConverter x:Key="BooleanNegationConverter" />
            <Style x:Key="PayrollRowBorderStyle"
                   TargetType="Border">
                <Setter Property="StrokeThickness"
                        Value="1" />
                <Setter Property="Stroke"
                        Value="Transparent" />
                <Setter Property="Padding"
                        Value="20,12" />
            </Style>
            <DataTemplate x:Key="PayrollPrimaryTemplate"
                          x:DataType="models:PayrollSummary">
                <Border Style="{StaticResource PayrollRowBorderStyle}"
                        BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1F1F1F}">
                    <Grid ColumnSpacing="12"
                          ColumnDefinitions="2*,Auto,Auto"
                          VerticalOptions="Center">
                        <Label Text="{Binding Name}"
                               FontAttributes="Bold" />
                        <Label Grid.Column="1"
                               Text="{Binding NetAmount, StringFormat='{0:C}'}"
                               FontSize="13"
                               HorizontalTextAlignment="End"
                               TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
                        <Label Grid.Column="2"
                               Text="{Binding Date, StringFormat='{0:d}'}"
                               FontSize="13"
                               HorizontalTextAlignment="End"
                               TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
                    </Grid>
                </Border>
            </DataTemplate>
            <DataTemplate x:Key="PayrollAlternateTemplate"
                          x:DataType="models:PayrollSummary">
                <Border Style="{StaticResource PayrollRowBorderStyle}"
                        BackgroundColor="{AppThemeBinding Light=#0A386eb3, Dark=#262626}">
                    <Grid ColumnSpacing="12"
                          ColumnDefinitions="2*,Auto,Auto"
                          VerticalOptions="Center">
                        <Label Text="{Binding Name}"
                               FontAttributes="Bold" />
                        <Label Grid.Column="1"
                               Text="{Binding NetAmount, StringFormat='{0:C}'}"
                               FontSize="13"
                               HorizontalTextAlignment="End"
                               TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
                        <Label Grid.Column="2"
                               Text="{Binding Date, StringFormat='{0:d}'}"
                               FontSize="13"
                               HorizontalTextAlignment="End"
                               TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
                    </Grid>
                </Border>
            </DataTemplate>
            <selectors:AlternateRowTemplateSelector x:Key="PayrollTemplateSelector"
                                                    PrimaryTemplate="{StaticResource PayrollPrimaryTemplate}"
                                                    AlternateTemplate="{StaticResource PayrollAlternateTemplate}" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid Padding="20,40"
          RowDefinitions="Auto,Auto,*,Auto"
          RowSpacing="16">
        <Grid ColumnDefinitions="*,Auto,Auto,Auto"
              ColumnSpacing="12">
            <Label Text="Payroll"
                   Style="{StaticResource HeadingTextStyle}" />
            <Button Grid.Column="1"
                    Text="Previous Period"
                    Command="{Binding PreviousPeriodCommand}"
                    SemanticProperties.Hint="View the previous payroll period" />
            <Button Grid.Column="2"
                    Text="Next Period"
                    Command="{Binding NextPeriodCommand}"
                    SemanticProperties.Hint="View the next payroll period" />
            <Button Grid.Column="3"
                    Text="Refresh"
                    Command="{Binding RefreshCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource BooleanNegationConverter}}"
                    SemanticProperties.Hint="Reload the current payroll period records" />
        </Grid>
        <Grid Grid.Row="1"
              ColumnDefinitions="Auto,*,Auto,*"
              ColumnSpacing="12"
              RowSpacing="4">
            <VerticalStackLayout Padding="0 " VerticalOptions="End">
                <Label Text="Period"
                       VerticalOptions="Center"
                       TextColor="{StaticResource TextSecondaryColor}" />
                <Label Grid.Column="1"
                       Text="{Binding PeriodRangeDisplay}"
                       FontAttributes="Bold"
                       FontSize="Small"
                       VerticalTextAlignment="Center"
                       VerticalOptions="End" />
            </VerticalStackLayout>
            <Label Grid.Column="2"
                   Text="Charging Filter"
                   VerticalOptions="Center"
                   TextColor="{StaticResource TextSecondaryColor}" />
            <Entry Grid.Column="3"
                   Text="{Binding ChargingFilter}"
                   Placeholder="Filter by charging"
                   ClearButtonVisibility="WhileEditing" />
        </Grid>
        <Grid Grid.Row="2">
            <CollectionView ItemsSource="{Binding Payrolls}"
                            ItemTemplate="{StaticResource PayrollTemplateSelector}">
                <CollectionView.Header>
                    <Border StrokeShape="RoundRectangle 10 10 0 0"
                            BackgroundColor="{AppThemeBinding Light={StaticResource AccentColor}, Dark=#1F5AA8}">
                        <Grid ColumnSpacing="12"
                              Padding="20,14"
                              ColumnDefinitions="2*,Auto,Auto">
                            <Label Text="Employee"
                                   TextColor="White"
                                   FontAttributes="Bold" />
                            <Label Grid.Column="1"
                                   Text="Net Amount"
                                   TextColor="White"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="End" />
                            <Label Grid.Column="2"
                                   Text="Date"
                                   TextColor="White"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="End" />
                        </Grid>
                    </Border>
                </CollectionView.Header>
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="24"
                                         HorizontalOptions="Center"
                                         VerticalOptions="Center"
                                         Spacing="8">
                        <Label Text="No payroll records"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Generate payroll to populate this list."
                               HorizontalTextAlignment="Center"
                               FontSize="12" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
        </Grid>
        <HorizontalStackLayout Grid.Row="3"
                               HorizontalOptions="End"
                               Spacing="8"
                               IsVisible="{Binding HasPagination}">
            <Label Text="Page"
                   VerticalOptions="Center"
                   TextColor="{StaticResource TextSecondaryColor}" />
            <CollectionView ItemsSource="{Binding PageNumbers}"
                            SelectionMode="None"
                            ItemsLayout="HorizontalList">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Button Text="{Binding .}"
                                Padding="8,4"
                                Command="{Binding Source={x:Reference PayrollPageRoot}, Path=BindingContext.GoToPageCommand}"
                                CommandParameter="{Binding .}" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </HorizontalStackLayout>
    </Grid>
</ContentPage>
