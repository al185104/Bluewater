<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Bluewater.App.Models"
             xmlns:selectors="clr-namespace:Bluewater.App.Selectors"
             x:Class="Bluewater.App.Views.EmployeePage"
             x:Name="EmployeePageView"
             Title="Employees">
  <ContentPage.Resources>
    <ResourceDictionary>
      <Style x:Key="EmployeeRowBorderStyle" TargetType="Border">
        <Setter Property="StrokeThickness" Value="1" />
        <Setter Property="Stroke" Value="{AppThemeBinding Light=#E0E0E0, Dark=#303030}" />
        <Setter Property="Padding" Value="12,8" />
        <Setter Property="Margin" Value="0,0,0,4" />
        <Setter Property="StrokeShape">
          <Setter.Value>
            <RoundRectangle CornerRadius="8" />
          </Setter.Value>
        </Setter>
      </Style>

      <DataTemplate x:Key="EmployeePrimaryTemplate" x:DataType="models:EmployeeSummary">
        <Border Style="{StaticResource EmployeeRowBorderStyle}"
                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1F1F1F}">
          <Grid ColumnSpacing="12"
                ColumnDefinitions="Auto,2*,*,*,*,*,*,*,Auto"
                VerticalOptions="Center">
            <Grid WidthRequest="40"
                  HeightRequest="40"
                  VerticalOptions="Center"
                  HorizontalOptions="Start">
              <Image Source="{Binding Image}"
                     IsVisible="{Binding HasImage}"
                     HeightRequest="40"
                     WidthRequest="40"
                     Aspect="AspectFill">
                <Image.Clip>
                  <EllipseGeometry Center="20,20" RadiusX="20" RadiusY="20" />
                </Image.Clip>
              </Image>
            </Grid>
            <Label Grid.Column="1" Text="{Binding FullName}" FontAttributes="Bold" FontSize="14" />
            <Label Grid.Column="2" Text="{Binding Position}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="3" Text="{Binding Department}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="4" Text="{Binding Section}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="5" Text="{Binding Type}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="6" Text="{Binding Level}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="7"
                   Text="{Binding Email}"
                   FontSize="13"
                   TextColor="{AppThemeBinding Light=#0A84FF, Dark=#63A4FF}" />
            <HorizontalStackLayout Grid.Column="8" Spacing="8" HorizontalOptions="End" VerticalOptions="Center">
              <Button Text="Edit"
                      Command="{Binding Source={x:Reference EmployeePageView}, Path=BindingContext.EditEmployeeCommand}"
                      CommandParameter="{Binding .}"
                      StyleClass="TableActionButton" />
              <Button Text="Delete"
                      Command="{Binding Source={x:Reference EmployeePageView}, Path=BindingContext.DeleteEmployeeCommand}"
                      CommandParameter="{Binding .}"
                      StyleClass="TableActionButton"
                      TextColor="{AppThemeBinding Light=#D14343, Dark=#FF8B8B}" />
            </HorizontalStackLayout>
          </Grid>
        </Border>
      </DataTemplate>

      <DataTemplate x:Key="EmployeeAlternateTemplate" x:DataType="models:EmployeeSummary">
        <Border Style="{StaticResource EmployeeRowBorderStyle}"
                BackgroundColor="{AppThemeBinding Light=#F7F7F7, Dark=#262626}">
          <Grid ColumnSpacing="12"
                ColumnDefinitions="Auto,2*,*,*,*,*,*,*,Auto"
                VerticalOptions="Center">
            <Grid WidthRequest="40"
                  HeightRequest="40"
                  VerticalOptions="Center"
                  HorizontalOptions="Start">
              <Image Source="{Binding Image}"
                     IsVisible="{Binding HasImage}"
                     HeightRequest="40"
                     WidthRequest="40"
                     Aspect="AspectFill">
                <Image.Clip>
                  <EllipseGeometry Center="20,20" RadiusX="20" RadiusY="20" />
                </Image.Clip>
              </Image>
            </Grid>
            <Label Grid.Column="1" Text="{Binding FullName}" FontAttributes="Bold" FontSize="14" />
            <Label Grid.Column="2" Text="{Binding Position}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="3" Text="{Binding Department}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="4" Text="{Binding Section}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="5" Text="{Binding Type}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="6" Text="{Binding Level}" FontSize="13" TextColor="{AppThemeBinding Light=#444444, Dark=#DDDDDD}" />
            <Label Grid.Column="7"
                   Text="{Binding Email}"
                   FontSize="13"
                   TextColor="{AppThemeBinding Light=#0A84FF, Dark=#63A4FF}" />
            <HorizontalStackLayout Grid.Column="8" Spacing="8" HorizontalOptions="End" VerticalOptions="Center">
              <Button Text="Edit"
                      Command="{Binding Source={x:Reference EmployeePageView}, Path=BindingContext.EditEmployeeCommand}"
                      CommandParameter="{Binding .}"
                      StyleClass="TableActionButton" />
              <Button Text="Delete"
                      Command="{Binding Source={x:Reference EmployeePageView}, Path=BindingContext.DeleteEmployeeCommand}"
                      CommandParameter="{Binding .}"
                      StyleClass="TableActionButton"
                      TextColor="{AppThemeBinding Light=#D14343, Dark=#FF8B8B}" />
            </HorizontalStackLayout>
          </Grid>
        </Border>
      </DataTemplate>

      <selectors:AlternateEmployeeTemplateSelector x:Key="EmployeeRowTemplateSelector"
                                                    PrimaryTemplate="{StaticResource EmployeePrimaryTemplate}"
                                                    AlternateTemplate="{StaticResource EmployeeAlternateTemplate}" />
    </ResourceDictionary>
  </ContentPage.Resources>
  <Grid Padding="16" RowDefinitions="Auto,*" RowSpacing="16">
    <Grid Grid.Row="1">
      <CollectionView ItemsSource="{Binding Employees}"
                      SelectionMode="None"
                      VerticalOptions="Fill"
                      ItemTemplateSelector="{StaticResource EmployeeRowTemplateSelector}">
        <CollectionView.Header>
          <Grid ColumnSpacing="12"
                Padding="12,8"
                BackgroundColor="{AppThemeBinding Light=#0A84FF, Dark=#1F5AA8}"
                ColumnDefinitions="Auto,2*,*,*,*,*,*,*,Auto">
            <Label Text="Photo"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="1"
                   Text="Name"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="2"
                   Text="Position"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="3"
                   Text="Department"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="4"
                   Text="Section"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="5"
                   Text="Type"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="6"
                   Text="Level"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="7"
                   Text="Email"
                   TextColor="White"
                   FontAttributes="Bold" />
            <Label Grid.Column="8"
                   Text="Actions"
                   TextColor="White"
                   HorizontalOptions="End"
                   FontAttributes="Bold" />
          </Grid>
        </CollectionView.Header>
        <CollectionView.EmptyView>
          <VerticalStackLayout HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Spacing="8">
            <Label Text="No employees found" />
            <Label Text="Employees will appear here once they are available." FontSize="12" />
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>

      <ActivityIndicator IsRunning="{Binding IsBusy}"
                         IsVisible="{Binding IsBusy}"
                         HorizontalOptions="Center"
                         VerticalOptions="Center" />
    </Grid>
  </Grid>
</ContentPage>
